<!DOCTYPE html>
<html>
  <head>
    <title>
      {{if .IsNew}}Register New SP{{else}}Edit SP{{end}} - Tailscale OIDC Identity Provider
    </title>
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body>
    {{template "header"}}

    <main>
      <div class="form-container">
        <div class="form-header">
          <h2>
            {{if .IsNew}}Register New SAML Service Provider{{else}}Edit SAML Service Provider{{end}}
          </h2>
          <a href="/saml/sp" class="btn btn-secondary">‚Üê Back to SAML SPs</a>
        </div>

        {{if .Success}}
        <div class="alert alert-success">
          {{.Success}}
        </div>
        {{end}}

        {{if .Error}}
        <div class="alert alert-error">
          {{.Error}}
        </div>
        {{end}}

        <form method="POST" class="client-form">
          <div class="form-group">
            <label for="name">Name <span class="required">*</span></label>
            <input
              type="text"
              id="name"
              name="name"
              value="{{.Name}}"
              placeholder="e.g., My Application"
              class="form-input"
              required
            >
            <div class="form-help">
              A descriptive name for this service provider.
            </div>
          </div>

          {{if .IsNew}}
          <div class="form-group">
            <label for="entity_id">Entity ID <span class="required">*</span></label>
            <input
              type="text"
              id="entity_id"
              name="entity_id"
              value="{{.EntityID}}"
              placeholder="https://app.example.com/saml"
              class="form-input"
              required
            >
            <div class="form-help">
              Unique identifier for the SP (usually a URL from SP metadata).
            </div>
          </div>
          {{else}}
          <div class="form-group">
            <label>Entity ID</label>
            <input
              type="text"
              value="{{.EntityID}}"
              readonly
              class="form-input form-input-readonly"
            >
            <div class="form-help">
              The entity ID cannot be changed after creation.
            </div>
          </div>
          {{end}}

          <div class="form-group">
            <label for="acs_urls">ACS URLs (one per line) <span class="required">*</span></label>
            <textarea
              id="acs_urls"
              name="acs_urls"
              placeholder="https://app.example.com/saml/acs&#10;https://app.example.com/saml/acs/callback"
              class="form-input"
              rows="5"
              required
            >{{range .ACSURLs}}{{.}}
{{end}}</textarea>
            <div class="form-help">
              Assertion Consumer Service URLs where SAML responses will be sent. Enter one URL per line.
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              {{if .IsNew}}Register SP{{else}}Update SP{{end}}
            </button>

            {{if .IsEdit}}
            <button type="submit" name="action" value="delete" class="btn btn-danger"
                    onclick="return confirm('Are you sure you want to delete this service provider? This cannot be undone.')">
              Delete SP
            </button>
            {{end}}
          </div>
        </form>
      </div>
    </main>
  </body>
</html>
